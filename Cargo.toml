[package]
name = "wasm-tools"
version = "0.1.0"
authors = ["The Wasmtime Project Developers"]
edition = "2018"
publish = false

[workspace]
members = ['fuzz', 'crates/wasm-encoder', 'crates/fuzz-stats', 'crates/wasm-mutate-stats']

[dependencies]
anyhow = "1.0"
env_logger = "0.8"
log = "0.4"
structopt = "0.3.16"
tempfile = "3.2.0"
wat = { path = "crates/wat", optional = true }

# Dependencies of `validate`
wasmparser = { path = "crates/wasmparser", optional = true }
rayon = { version = "1.0", optional = true }

# Dependencies of `print`
wasmprinter = { path = "crates/wasmprinter", optional = true }

# Dependencies of `smith`
arbitrary = { version = "1.0.0", optional = true }
serde = { version = "1", features = ['derive'], optional = true }
serde_json = { version = "1", optional = true }
wasm-smith = { path = "crates/wasm-smith", features = ["_internal_cli"], optional = true }

# Dependencies of `shrink`
wasm-shrink = { path = "crates/wasm-shrink", features = ["structopt"], optional = true}
is_executable = { version = "1.0.1", optional = true }

# Dependencies of `mutate`
wasm-mutate = { path = "crates/wasm-mutate", features = ["structopt"], optional = true }

# Dependencies of `dump`
wasmparser-dump = { path = "crates/dump", optional = true }

[dev-dependencies]
anyhow = "1.0"
getopts = "0.2"
serde_json = "1.0"
tempfile = "3.1"
diff = "0.1"
wasmparser-dump = { path = 'crates/dump' }
wast = { path = 'crates/wast' }

[[test]]
name = "dump"
harness = false

[[test]]
name = "roundtrip"
harness = false

[features]
# By default, all subcommands are built
default = ['shrink', 'smith', 'mutate', 'validate', 'print', 'parse', 'dump', 'objdump']

# Each subcommand is gated behind a feature and lists the dependencies it needs
validate = ['wasmparser', 'rayon', 'wat']
print = ['wasmprinter']
parse = ['wat']
smith = ['wasm-smith', 'arbitrary', 'serde', 'serde_json']
shrink = ['wasm-shrink', 'is_executable', 'wat', 'wasmprinter']
mutate = ['wasm-mutate', 'wat']
dump = ['wasmparser-dump', 'wat']
objdump = ['wasmparser', 'wat']
